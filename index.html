<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arlington MA Trash Schedule</title>
    <!-- Load Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for colors and large text to match original design intent */
        .status-yes { color: #FF6B6B; } /* Fun Salmon */
        .status-no { color: #4ECDC4; } /* Fun Teal */
        .status-text {
            font-size: 8rem;
            font-weight: 900;
            line-height: 1;
            margin: 0;
        }
        @media (max-width: 640px) {
            .status-text { font-size: 5rem; }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-light': '#F7F9FC',
                        'text-dark': '#2D3748',
                        'card-bg': '#FFFFFF',
                        'accent-yes': '#FF6B6B',
                        'accent-no': '#4ECDC4',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-bg-light text-text-dark flex flex-col items-center min-h-screen p-4 sm:p-8">

    <header class="text-center mt-6 mb-4 max-w-xl">
        <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight text-text-dark">
            Is trash collection in Arlington, MA delayed this week?
        </h1>
    </header>
    
    <!-- New Selected Date Indicator -->
    <div id="current-date-display" class="w-full max-w-xl mb-6 hidden">
        <!-- Content inserted by JavaScript when a debug date is selected -->
    </div>
    
    <!-- Out-of-Range Alert -->
    <div id="range-alert" class="w-full max-w-xl mb-6 hidden">
        <!-- Content inserted by JavaScript -->
    </div>

    <!-- Main Status Card -->
    <div id="status-container" class="main-status bg-card-bg p-10 sm:p-14 rounded-2xl shadow-xl text-center mb-8 w-full max-w-lg transition-transform hover:scale-[1.01]">
        <div class="status-text">...</div>
    </div>
    
    <!-- Delay Schedule Card (MOVED UP) -->
    <div id="delay-schedule-card" class="info-card bg-card-bg p-6 sm:p-8 rounded-xl shadow-md mb-8 w-full max-w-xl hidden">
        <h2 class="text-xl font-bold mb-4 pb-2 border-b-2 border-gray-100 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent-yes mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            This Week's Revised Schedule
        </h2>
        <div id="schedule-details">
            <!-- Schedule items will be inserted here by JavaScript -->
        </div>
    </div>

    <!-- Yard Waste Status Container -->
    <div id="yard-waste-container" class="w-full max-w-lg mb-8 p-4 bg-green-50 rounded-lg shadow-sm text-center text-sm font-medium border border-green-200 hidden">
        <!-- Content inserted by JavaScript -->
    </div>
    
    <!-- Christmas Tree Alert Card (New Feature) -->
    <div id="tree-pickup-alert" class="w-full max-w-lg mb-8 p-4 rounded-xl shadow-md text-center hidden">
        <!-- Content inserted by JavaScript -->
    </div>

    <!-- Info Sections -->
    <div class="info-section w-full max-w-xl">
        
        <!-- Special Schedules Card -->
        <div id="special-schedules-card" class="info-card bg-card-bg p-6 sm:p-8 rounded-xl shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4 pb-2 border-b-2 border-gray-100">
                Special Schedules
            </h2>
            <ul id="special-schedules-list" class="divide-y divide-gray-100">
                <!-- Special items will be dynamically inserted here -->
            </ul>
        </div>

        <!-- Upcoming Holidays Card -->
        <div class="info-card bg-card-bg p-6 sm:p-8 rounded-xl shadow-md mb-8">
            <h2 class="text-xl font-bold mb-4 pb-2 border-b-2 border-gray-100">
                Upcoming Holidays
            </h2>
            <ul id="holiday-list" class="divide-y divide-gray-100">
                <!-- Holidays will be inserted here by JavaScript -->
            </ul>
        </div>

        <div class="text-center">
            <a href="https://www.arlingtonma.gov/home/showpublisheddocument/74122/638849685213600000" target="_blank" class="inline-block bg-text-dark text-white py-3 px-8 rounded-full font-bold transition duration-300 hover:bg-black shadow-lg">
                View Official PDF Calendar
            </a>
        </div>
    </div>
    
    <!-- Debug Date Picker (Hidden Feature) - Moved before footer -->
    <div id="debug-section" class="w-full max-w-xl flex flex-col items-center mt-6">
        <a href="#" id="debug-toggle" onclick="return false;" class="text-sm text-gray-400 hover:text-gray-600 transition duration-150 underline cursor-pointer mb-2">
            Click to change date
        </a>

        <!-- Collapsible Content - Hidden by default, subtle styling -->
        <div id="debug-content" class="hidden w-full max-w-sm bg-white p-3 rounded-lg shadow-md border border-gray-200">
            <p class="text-xs text-gray-500 mb-2">
                Select a date to test the schedule status:
            </p>
            <div class="flex space-x-2">
                <input type="date" id="debug-date-picker" class="flex-grow p-2 border border-gray-300 rounded-lg text-sm focus:ring-yellow-500 focus:border-yellow-500">
                <button id="reset-date-btn" class="bg-gray-500 text-white py-2 px-3 rounded-lg font-medium hover:bg-gray-600 transition flex-shrink-0 text-sm">
                    Reset
                </button>
            </div>
        </div>
    </div>

    <footer class="mt-auto text-sm text-gray-400 text-center pt-10 pb-4">
        Based on the 2025-2026 Arlington MA Collection Calendar.<br>
        Always verify with the official PDF if unsure.<br>
        This information is based on the static PDF schedule and does not update for emergency or real-time changes.
    </footer>

    <script>
        // --- Configuration ---
        const CALENDAR_START = new Date(2025, 6, 1); // July 1, 2025 (0-indexed month)
        const CALENDAR_END = new Date(2026, 5, 30);  // June 30, 2026 (0-indexed month)
        
        // List of all holidays (delaying and non-delaying)
        // delayType: 'full_week' = shifts Mon-Fri, 'remainder' = shifts days on or after holiday, 'none' = no delay
        // affectsDay is the Day Index (1=Mon, 2=Tue, ..., 5=Fri) that the holiday falls on.
        const delayHolidays = [
            // Delaying Holidays (Cause 1-Day Shift)
            { date: '2025-11-27', name: 'Thanksgiving', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2025-12-25', name: 'Christmas Day', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2026-01-01', name: 'New Year\'s Day', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2026-05-25', name: 'Memorial Day', delayType: 'full_week', affectsDay: 1 }, // Monday (1)
            { date: '2026-09-07', name: 'Labor Day', delayType: 'full_week', affectsDay: 1 }, // Monday (1)
            { date: '2026-11-26', name: 'Thanksgiving', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2026-12-25', name: 'Christmas Day', delayType: 'remainder', affectsDay: 5 }, // Friday (5)

            // Non-Delaying Holidays (For status clarity, based on common local policies)
            { date: '2025-10-13', name: 'Indigenous Peoples\' Day', delayType: 'none', affectsDay: 1 }, // Monday
            { date: '2025-11-11', name: 'Veterans Day', delayType: 'none', affectsDay: 2 }, // Tuesday
            { date: '2026-01-19', name: 'MLK Day', delayType: 'none', affectsDay: 1 }, // Monday
            { date: '2026-07-04', name: 'Independence Day', delayType: 'none', affectsDay: 6 }, // Saturday (6)
        ];

        // --- Yard Waste Configuration (Bi-weekly schedule starts July 7, 2025 - Week A) ---
        // Yard Waste is Bi-weekly (Apr - Oct, Week A starts July 7, 2025) and Weekly (Nov - Mid Dec)
        const YARD_WASTE_START_WEEK_A = new Date(2025, 6, 7); // Monday, July 7, 2025
        const YARD_WASTE_END_BIWEEKLY_FALL = new Date(2025, 9, 31); // End of October (Bi-weekly)
        const YARD_WASTE_START_WEEKLY = new Date(2025, 10, 1); // Start of November (Weekly)
        const YARD_WASTE_END_FALL_WEEKLY = new Date(2025, 11, 12); // Mid-December (Weekly)
        const YARD_WASTE_START_SPRING_BIWEEKLY = new Date(2026, 3, 13); // Mid-April (Bi-weekly)
        const YARD_WASTE_END_SPRING = new Date(2026, 5, 30); // End of Calendar (Bi-weekly)
        
        // --- Christmas Tree Pickup Configuration (Jan 12-16, 2026) ---
        const TREE_PICKUP_START = new Date(2026, 0, 12); // Jan 12, 2026 (Monday)
        const TREE_PICKUP_END = new Date(2026, 0, 16); // Jan 16, 2026 (Friday)
        const TREE_DISPLAY_START = new Date(2026, 0, 1); // Jan 1, 2026 (Start showing the alert)


        /**
         * Helper: Get Start/End of current week (Sunday to Saturday) based on the input date.
         * @param {string|null} debugDateStr - Optional date string (YYYY-MM-DD) to override 'today'.
         * @returns {object} { start: Date, end: Date, now: Date }
         */
        function getCurrentWeek(debugDateStr = null) {
            let now;
            if (debugDateStr) {
                // Parse date string into a Date object (using local time parsing)
                const parts = debugDateStr.split('-').map(Number);
                // Year, Month (0-indexed), Day
                now = new Date(parts[0], parts[1] - 1, parts[2]);
            } else {
                now = new Date();
            }

            now.setHours(0, 0, 0, 0); // Reset time to midnight for accurate comparison

            const dayOfWeek = now.getDay(); // 0 (Sun) - 6 (Sat)

            const start = new Date(now);
            start.setDate(now.getDate() - dayOfWeek); // Start is Sunday (0)

            const end = new Date(now);
            end.setDate(now.getDate() + (6 - dayOfWeek)); // End is Saturday (6)

            return { start, end, now };
        }

        // Helper: Format date
        function formatDate(dateObj) {
            return dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Helper: Get day name from index (0=Sun, 1=Mon, ..., 6=Sat)
        function getDayName(dayIndex) {
            return ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][dayIndex % 7];
        }

        /**
         * Calculates the collection schedule for the week based on a holiday delay (fixed one-day shift).
         * @param {object} holiday - The holiday object causing the delay.
         * @returns {string} HTML string of the revised schedule.
         */
        function calculateSchedule(holiday) {
            // Collection days: Monday=1, ..., Friday=5
            const collectionDays = [1, 2, 3, 4, 5];
            const holidayDay = holiday.affectsDay; // Day index (1-5) of the holiday

            let html = '';
            
            // Generate the list of original collection days and their revised schedule
            html += collectionDays.map(originalDay => {
                let newDayIndex = originalDay;
                let isDelayed = false;

                if (
                    (holiday.delayType === 'full_week' && holidayDay === 1) || // E.g., Memorial Day (Mon) shifts whole week
                    (holiday.delayType === 'remainder' && originalDay >= holidayDay) // E.g., Thanksgiving (Thu) shifts Thu/Fri
                ) {
                    newDayIndex = originalDay + 1; // Shift by exactly one day
                    isDelayed = true;
                }
                
                const newDayName = getDayName(newDayIndex);
                const originalDayName = getDayName(originalDay);
                
                let icon = isDelayed 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent-yes mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 17l-4 4-4-4"/><path d="M12 12V3"/></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent-no mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17L4 12"/></svg>`;

                let statusText = isDelayed 
                    ? `<span class="font-semibold text-accent-yes">${newDayName}</span>`
                    : `<span class="font-semibold text-accent-no">${newDayName} (Regular)</span>`;

                return `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0 text-gray-700">
                        <div class="flex items-center text-lg">
                            ${icon} 
                            <span class="font-medium">Collection originally on ${originalDayName}:</span>
                        </div>
                        ${statusText}
                    </div>
                `;
            }).join('');
            
            return html;
        }
        
        /**
         * Determines the yard waste collection status for the current week.
         * @param {Date} now - The current or debug date (midnight).
         * @returns {object} { isPickup: boolean, message: string, detail: string, icon: string }
         */
        function getYardWasteStatus(now) {
            let status = { isPickup: false, message: '', detail: '', icon: '' };

            // Check for the *weekly* Fall period (Nov 1 - Dec 15, 2025)
            if (now >= YARD_WASTE_START_WEEKLY && now <= YARD_WASTE_END_FALL_WEEKLY) {
                status.isPickup = true;
                status.message = 'Yard Waste Weekly pickup is active this week.';
                status.detail = 'üçÇ Fall weekly collection runs December 12.';
                status.icon = 'üçÉ';
                return status;
            }
            
            // Check for the *bi-weekly* Spring period (Mid-April 2026 - Jun 30, 2026)
            if (now >= YARD_WASTE_START_SPRING_BIWEEKLY && now <= YARD_WASTE_END_SPRING) {
                // Calculate difference in milliseconds from Week A start date (which is Jul 7, 2025)
                const msDiff = now.getTime() - YARD_WASTE_START_WEEK_A.getTime();
                const dayDiff = Math.floor(msDiff / (1000 * 60 * 60 * 24));
                const weekNumber = Math.floor(dayDiff / 7);
                const isWeekA = (weekNumber % 2) === 0; // Check parity relative to July 7, 2025

                if (isWeekA) {
                    status.isPickup = true;
                    status.message = 'Yard Waste Bi-weekly pickup is active this week.';
                    status.detail = 'Spring bi-weekly collection is underway.';
                    status.icon = 'üçÉ';
                } else {
                    status.message = 'Yard Waste is NOT collected this week.';
                    status.detail = 'Spring bi-weekly collection resumes next week.';
                    status.icon = 'üö´';
                }
                return status;
            }
            
            // Check for the *bi-weekly* Summer/Fall period (July 1 - Oct 31, 2025)
            if (now >= CALENDAR_START && now <= YARD_WASTE_END_BIWEEKLY_FALL) {
                // Calculation is the same as the spring bi-weekly period
                const msDiff = now.getTime() - YARD_WASTE_START_WEEK_A.getTime();
                const dayDiff = Math.floor(msDiff / (1000 * 60 * 60 * 24));
                const weekNumber = Math.floor(dayDiff / 7);
                const isWeekA = (weekNumber % 2) === 0;

                if (isWeekA) {
                    status.isPickup = true;
                    status.message = 'Yard Waste Bi-weekly pickup is active this week.';
                    status.detail = 'Summer/Fall bi-weekly collection is underway.';
                    status.icon = 'üçÉ';
                } else {
                    status.message = 'Yard Waste is NOT collected this week.';
                    status.detail = 'Bi-weekly collection resumes next week.';
                    status.icon = 'üö´';
                }
                return status;
            }

            // Default: Outside of all seasonal periods (Dec 16 - Mid-April)
            status.message = 'Yard Waste collection is currently OFF-SEASON.';
            status.detail = 'Regular service pauses between mid-December and mid-April.';
            status.icon = '‚ùÑÔ∏è';
            return status;
        }

        /**
         * Renders the dynamic content for the Special Schedules card.
         * @param {Date} now - The current or debug date (midnight).
         */
        function updateSpecialSchedules(now) {
            const list = document.getElementById('special-schedules-list');
            list.innerHTML = '';
            
            const scheduleItems = [];

            // Christmas Tree Pickup is Jan 12 ‚Äî Jan 16, 2026. This is now based on the new constants.
            if (now >= TREE_DISPLAY_START && now <= TREE_PICKUP_END) {
                 scheduleItems.push(`
                    <li class="py-3 flex justify-between text-lg text-text-dark">
                        <span>üéÑ Christmas Tree Pickup</span>
                        <span class="font-bold text-gray-600">Jan 12 ‚Äî Jan 16, 2026</span>
                    </li>
                 `);
            }
            
            // Add static, seasonal yard waste notes for context, clarifying the calendar cycle
            
            // 1. Spring Bi-weekly (2026) - Starts mid-calendar, runs to end of calendar.
            scheduleItems.push(`
                <li class="py-3 flex justify-between text-lg text-text-dark">
                    <span>üå± Yard Waste: Bi-weekly Collection</span>
                    <span class="font-bold text-gray-600">From Apr 13, 2026</span>
                </li>
            `);
            // 2. Fall Weekly (2025) - Standard date range. (REMOVED 'Weekly pickup is underway.' DETAIL)
            scheduleItems.push(`
                <li class="py-3 flex justify-between text-lg text-text-dark">
                    <span>üçÇ Yard Waste: Fall Weekly</span>
                    <span class="font-bold text-gray-600">Nov 1 ‚Äî Dec 15, 2025</span>
                </li>
            `);
            // 3. Summer/Fall Bi-weekly (2025) - Starts with calendar, runs to end date.
            scheduleItems.push(`
                <li class="py-3 flex justify-between text-lg text-text-dark">
                    <span>‚òÄÔ∏è Yard Waste: Bi-weekly Collection</span>
                    <span class="font-bold text-gray-600">Until Oct 31, 2025</span>
                </li>
            `);


            list.innerHTML = scheduleItems.join('');
        }


        function init() {
            const datePicker = document.getElementById('debug-date-picker');
            const debugDate = datePicker.value;
            
            // Get current week using the debug date if present
            const { start, end, now } = getCurrentWeek(debugDate); 

            const statusContainer = document.getElementById('status-container');
            const holidayList = document.getElementById('holiday-list');
            const scheduleCard = document.getElementById('delay-schedule-card');
            const scheduleDetails = document.getElementById('schedule-details');
            const rangeAlert = document.getElementById('range-alert');
            const yardWasteContainer = document.getElementById('yard-waste-container');
            const currentDateDisplay = document.getElementById('current-date-display');
            const treeAlertContainer = document.getElementById('tree-pickup-alert'); 

            
            // Update Special Schedules card (for conditional Christmas Tree item and clear calendar notes)
            updateSpecialSchedules(now);


            // 0a. Display selected debug date if active
            if (debugDate) {
                currentDateDisplay.classList.remove('hidden');
                currentDateDisplay.innerHTML = `
                    <div class="p-3 bg-indigo-100 border border-indigo-300 text-indigo-800 rounded-xl shadow-sm">
                        üìÖ Showing schedule for: <strong class="font-bold">${formatDate(now)} (${getDayName(now.getDay())})</strong>
                        <span class="block mt-1 text-sm text-indigo-700">
                            Change the date using the picker below, or click "Reset" to go back to today's date.
                        </span>
                    </div>
                `;
            } else {
                currentDateDisplay.classList.add('hidden');
            }


            // 0b. Check if the current date is within the known calendar range
            const isDateInRange = now >= CALENDAR_START && now <= CALENDAR_END;
            
            if (!isDateInRange) {
                // Out-of-Range Handling (existing logic)
                rangeAlert.classList.remove('hidden');
                rangeAlert.innerHTML = `<div class="p-3 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg shadow-sm">
                    ‚ö†Ô∏è Warning: The selected date (${formatDate(now)}) is outside the published Town Calendar range (Jul 1, 2025 - Jun 30, 2026).
                </div>`;
                
                statusContainer.innerHTML = `
                    <div class="status-text text-gray-400">?</div>
                    <div class="text-2xl font-medium text-gray-500 mt-2">Date Outside Calendar Range</div>
                `;

                scheduleCard.classList.add('hidden');
                yardWasteContainer.classList.add('hidden'); // Hide yard waste status
                treeAlertContainer.classList.add('hidden'); // Hide tree alert
                holidayList.innerHTML = '<li class="py-3 text-center text-gray-400">Cannot determine status outside the calendar range.</li>';
                return; // Stop execution if out of range
            } else {
                rangeAlert.classList.add('hidden'); // Hide if we are in range
            }


            // 1. Check for holiday delay this week
            let isDelayed = false;
            let delayReason = "";
            let holidayThisWeek = null;

            const allHolidaysThisWeek = delayHolidays.filter(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m - 1, d);
                hDate.setHours(0, 0, 0, 0); 
                return hDate >= start && hDate <= end;
            });
            
            const delayingHoliday = allHolidaysThisWeek.find(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m-1, d);
                return h.delayType !== 'none' && hDate.getDay() >= 1 && hDate.getDay() <= 5;
            });

            if (delayingHoliday) {
                isDelayed = true;
                holidayThisWeek = delayingHoliday;
                const [y, m, d] = delayingHoliday.date.split('-').map(Number);
                const hDate = new Date(y, m-1, d);
                delayReason = `Due to ${delayingHoliday.name} on ${getDayName(hDate.getDay())}`;
            }

            // 2. Update Main Display (Trash Delay)
            let secondaryNote = "";
            if (!isDelayed) {
                 const nonDelayingHolidays = allHolidaysThisWeek.filter(h => h.delayType === 'none').map(h => h.name);
                 if (nonDelayingHolidays.length > 0) {
                    secondaryNote = `<span class="text-gray-400 font-medium"> (despite ${nonDelayingHolidays.join(' and ')})</span>`;
                 }
            }
            
            if (isDelayed) {
                statusContainer.innerHTML = `
                    <div class="status-text status-yes">YES</div>
                    <div class="text-2xl font-medium text-gray-500 mt-2">${delayReason}</div>
                `;
                scheduleCard.classList.remove('hidden');
                scheduleDetails.innerHTML = calculateSchedule(holidayThisWeek);

            } else {
                statusContainer.innerHTML = `
                    <div class="status-text status-no">NO</div>
                    <div class="text-2xl font-medium text-gray-500 mt-2">Regular Schedule ${secondaryNote}</div>
                `;
                scheduleCard.classList.add('hidden');
            }
            
            // 3. Update Yard Waste Status
            const ywStatus = getYardWasteStatus(now);
            yardWasteContainer.classList.remove('hidden');

            const ywColor = ywStatus.isPickup ? 'text-green-700' : 'text-yellow-700';
            const ywBg = ywStatus.isPickup ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200';
            
            yardWasteContainer.className = `w-full max-w-lg mb-8 p-4 rounded-xl shadow-sm text-center font-medium border flex items-center justify-center ${ywBg} ${ywColor}`;

            yardWasteContainer.innerHTML = `
                <span class="text-2xl mr-3">${ywStatus.icon}</span>
                <span>
                    <strong class="text-base">${ywStatus.message}</strong>
                    <span class="block text-xs font-normal text-gray-500">${ywStatus.detail}</span>
                </span>
            `;

            // 4. Update Christmas Tree Pickup Alert (NEW LOGIC)
            let treeAlertHtml = '';
            let treeAlertVisible = false;

            if (now >= TREE_DISPLAY_START && now <= TREE_PICKUP_END) {
                treeAlertVisible = true;
                
                if (now >= TREE_PICKUP_START && now <= TREE_PICKUP_END) {
                    // DURING THE WEEK (Jan 12 - Jan 16, 2026)
                    treeAlertHtml = `
                        <h3 class="text-xl font-bold text-red-700 flex items-center justify-center mb-1">
                            <span class="text-3xl mr-2">üö®</span>
                            CHRISTMAS TREE PICKUP WEEK!
                        </h3>
                        <p class="text-sm text-red-600 font-medium">
                            <strong class="underline">This is the only week.</strong> Place tree curbside on your collection day. No plastic bags or stands.
                        </p>
                    `;
                    treeAlertContainer.classList.add('bg-red-100', 'border', 'border-red-400');
                    treeAlertContainer.classList.remove('bg-blue-100', 'border-blue-400');

                } else if (now < TREE_PICKUP_START) {
                    // BEFORE THE WEEK (Jan 1 - Jan 11, 2026)
                    treeAlertHtml = `
                        <h3 class="text-xl font-bold text-blue-700 flex items-center justify-center mb-1">
                            <span class="text-3xl mr-2">üéÑ</span>
                            Heads Up: Tree Pickup is Coming!
                        </h3>
                        <p class="text-sm text-blue-600 font-medium">
                            Christmas Tree pickup is next week: <strong class="font-bold">Jan 12 ‚Äì Jan 16, 2026.</strong> This is a one-week only event.
                        </p>
                    `;
                    treeAlertContainer.classList.add('bg-blue-100', 'border', 'border-blue-400');
                    treeAlertContainer.classList.remove('bg-red-100', 'border-red-400');
                }
            }

            if (treeAlertVisible) {
                treeAlertContainer.innerHTML = treeAlertHtml;
                treeAlertContainer.classList.remove('hidden');
            } else {
                treeAlertContainer.classList.add('hidden');
            }

            // 5. Populate Upcoming Holidays List (existing logic)
            holidayList.innerHTML = ''; 
            
            const upcoming = delayHolidays.filter(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m - 1, d);
                hDate.setHours(0, 0, 0, 0);
                // Filter for holidays now or in the future AND within the calendar range
                return hDate >= now && hDate <= CALENDAR_END; 
            }).sort((a, b) => new Date(a.date) - new Date(b.date))
            .slice(0, 5);

            upcoming.forEach(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m - 1, d);
                const dayName = getDayName(hDate.getDay());
                
                let delayNote = '';
                if (h.delayType === 'full_week' || h.delayType === 'remainder') {
                    delayNote = `<span class="text-accent-yes font-bold">1-Day Delay</span>`;
                } else {
                    delayNote = `<span class="text-accent-no font-bold">No Delay</span>`;
                }

                const li = document.createElement('li');
                li.className = 'py-3 flex justify-between text-lg';
                li.innerHTML = `
                    <span>${h.name} (${delayNote})</span>
                    <span class="font-bold text-gray-600">${formatDate(hDate)} (${dayName})</span>
                `;
                holidayList.appendChild(li);
            });
            
            if (upcoming.length === 0) {
                 holidayList.innerHTML = '<li class="py-3 text-center text-gray-400">No major holidays with confirmed delays found in the current calendar.</li>';
            }
        }

        // --- Event Listeners for Debug Feature ---
        const debugContent = document.getElementById('debug-content');
        const toggleButton = document.getElementById('debug-toggle');

        toggleButton.addEventListener('click', (e) => {
            e.preventDefault();
            debugContent.classList.toggle('hidden');
            
            if (debugContent.classList.contains('hidden')) {
                toggleButton.textContent = 'Click to change date';
            } else {
                toggleButton.textContent = 'Hide date picker';
            }
        });

        document.getElementById('debug-date-picker').addEventListener('change', init);
        
        document.getElementById('reset-date-btn').addEventListener('click', () => {
             document.getElementById('debug-date-picker').value = '';
             init();
        });

        // Initial run
        init();
    </script>
</body>
</html>
