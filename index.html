<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arlington MA Trash Schedule</title>
    <!-- Load Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for colors and large text to match original design intent */
        .status-yes { color: #FF6B6B; } /* Fun Salmon */
        .status-no { color: #4ECDC4; } /* Fun Teal */
        .status-text {
            font-size: 8rem;
            font-weight: 900;
            line-height: 1;
            margin: 0;
        }
        @media (max-width: 640px) {
            .status-text { font-size: 5rem; }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-light': '#F7F9FC',
                        'text-dark': '#2D3748',
                        'card-bg': '#FFFFFF',
                        'accent-yes': '#FF6B6B',
                        'accent-no': '#4ECDC4',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-bg-light text-text-dark flex flex-col items-center min-h-screen p-4 sm:p-8">

    <header class="text-center mt-6 mb-4 max-w-xl">
        <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight text-text-dark">
            Is trash collection in Arlington, MA delayed this week?
        </h1>
    </header>
    
    <!-- Out-of-Range Alert -->
    <div id="range-alert" class="w-full max-w-xl mb-6 hidden">
        <!-- Content inserted by JavaScript -->
    </div>

    <!-- Main Status Card -->
    <div id="status-container" class="main-status bg-card-bg p-10 sm:p-14 rounded-2xl shadow-xl text-center mb-8 w-full max-w-lg transition-transform hover:scale-[1.01]">
        <div class="status-text">...</div>
    </div>

    <!-- Delay Schedule Card (New Feature) -->
    <div id="delay-schedule-card" class="info-card bg-card-bg p-6 sm:p-8 rounded-xl shadow-md mb-8 w-full max-w-xl hidden">
        <h2 class="text-xl font-bold mb-4 pb-2 border-b-2 border-gray-100 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent-yes mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            This Week's Revised Schedule
        </h2>
        <div id="schedule-details">
            <!-- Schedule items will be inserted here by JavaScript -->
        </div>
    </div>

    <!-- Info Sections -->
    <div class="info-section w-full max-w-xl">
        
        <!-- Special Schedules Card -->
        <div class="info-card bg-card-bg p-6 sm:p-8 rounded-xl shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4 pb-2 border-b-2 border-gray-100">
                Special Schedules
            </h2>
            <ul class="divide-y divide-gray-100">
                <li class="py-3 flex justify-between text-lg">
                    <span>üéÑ Christmas Tree Pickup</span>
                    <span class="font-bold text-gray-600">Jan 12 - Jan 16</span>
                </li>
                <li class="py-3 flex justify-between text-lg">
                    <span>üçÇ Yard Waste (Fall)</span>
                    <span class="font-bold text-gray-600">Weekly thru early Dec</span>
                </li>
                <li class="py-3 flex justify-between text-lg">
                    <span>üå± Yard Waste (Spring)</span>
                    <span class="font-bold text-gray-600">Starts mid-April</span>
                </li>
            </ul>
        </div>

        <!-- Upcoming Holidays Card -->
        <div class="info-card bg-card-bg p-6 sm:p-8 rounded-xl shadow-md mb-8">
            <h2 class="text-xl font-bold mb-4 pb-2 border-b-2 border-gray-100">
                Upcoming Holidays (Confirmed Delays)
            </h2>
            <ul id="holiday-list" class="divide-y divide-gray-100">
                <!-- Holidays will be inserted here by JavaScript -->
            </ul>
        </div>

        <div class="text-center">
            <a href="https://www.arlingtonma.gov/home/showpublisheddocument/74122/638849685213600000" target="_blank" class="inline-block bg-text-dark text-white py-3 px-8 rounded-full font-bold transition duration-300 hover:bg-black shadow-lg">
                View Official PDF Calendar
            </a>
        </div>
    </div>
    
    <!-- Debug Date Picker (Hidden Feature) - Moved before footer -->
    <div id="debug-section" class="w-full max-w-xl flex flex-col items-center mt-6">
        <a href="#" id="debug-toggle" onclick="return false;" class="text-sm text-gray-400 hover:text-gray-600 transition duration-150 underline cursor-pointer mb-2">
            Click to change date
        </a>

        <!-- Collapsible Content - Hidden by default, subtle styling -->
        <div id="debug-content" class="hidden w-full max-w-sm bg-white p-3 rounded-lg shadow-md border border-gray-200">
            <p class="text-xs text-gray-500 mb-2">
                Select a date to test the schedule status:
            </p>
            <div class="flex space-x-2">
                <input type="date" id="debug-date-picker" class="flex-grow p-2 border border-gray-300 rounded-lg text-sm focus:ring-yellow-500 focus:border-yellow-500">
                <button id="reset-date-btn" class="bg-gray-500 text-white py-2 px-3 rounded-lg font-medium hover:bg-gray-600 transition flex-shrink-0 text-sm">
                    Reset
                </button>
            </div>
        </div>
    </div>

    <footer class="mt-auto text-sm text-gray-400 text-center pt-10 pb-4">
        Based on the 2025-2026 Arlington MA Collection Calendar.<br>
        Always verify with the official PDF if unsure.<br>
        This website is static and does not update in case of emergency changes to the collection schedule.<br>
    </footer>

    <script>
        // --- Configuration ---
        const CALENDAR_START = new Date(2025, 6, 1); // July 1, 2025 (0-indexed month)
        const CALENDAR_END = new Date(2026, 5, 30);  // June 30, 2026 (0-indexed month)
        
        // List of all holidays (delaying and non-delaying)
        // delayType: 'full_week' = shifts Mon-Fri, 'remainder' = shifts days on or after holiday, 'none' = no delay
        // affectsDay is the Day Index (1=Mon, 2=Tue, ..., 5=Fri) that the holiday falls on.
        const delayHolidays = [
            // Delaying Holidays (Cause 1-Day Shift)
            { date: '2025-11-27', name: 'Thanksgiving', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2025-12-25', name: 'Christmas Day', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2026-01-01', name: 'New Year\'s Day', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2026-05-25', name: 'Memorial Day', delayType: 'full_week', affectsDay: 1 }, // Monday (1)
            { date: '2026-09-07', name: 'Labor Day', delayType: 'full_week', affectsDay: 1 }, // Monday (1)
            { date: '2026-11-26', name: 'Thanksgiving', delayType: 'remainder', affectsDay: 4 }, // Thursday (4)
            { date: '2026-12-25', name: 'Christmas Day', delayType: 'remainder', affectsDay: 5 }, // Friday (5)

            // Non-Delaying Holidays (For status clarity, based on common local policies)
            { date: '2025-10-13', name: 'Indigenous Peoples\' Day', delayType: 'none', affectsDay: 1 }, // Monday
            { date: '2025-11-11', name: 'Veterans Day', delayType: 'none', affectsDay: 2 }, // Tuesday
            { date: '2026-01-19', name: 'MLK Day', delayType: 'none', affectsDay: 1 }, // Monday
            { date: '2026-07-04', name: 'Independence Day', delayType: 'none', affectsDay: 6 }, // Saturday (6)
        ];

        /**
         * Helper: Get Start/End of current week (Sunday to Saturday) based on the input date.
         * @param {string|null} debugDateStr - Optional date string (YYYY-MM-DD) to override 'today'.
         * @returns {object} { start: Date, end: Date, now: Date }
         */
        function getCurrentWeek(debugDateStr = null) {
            let now;
            if (debugDateStr) {
                // Parse date string into a Date object (using local time parsing)
                const parts = debugDateStr.split('-').map(Number);
                // Year, Month (0-indexed), Day
                now = new Date(parts[0], parts[1] - 1, parts[2]);
            } else {
                now = new Date();
            }

            now.setHours(0, 0, 0, 0); // Reset time to midnight for accurate comparison

            const dayOfWeek = now.getDay(); // 0 (Sun) - 6 (Sat)

            const start = new Date(now);
            start.setDate(now.getDate() - dayOfWeek); // Start is Sunday (0)

            const end = new Date(now);
            end.setDate(now.getDate() + (6 - dayOfWeek)); // End is Saturday (6)

            return { start, end, now };
        }

        // Helper: Format date
        function formatDate(dateObj) {
            return dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Helper: Get day name from index (0=Sun, 1=Mon, ..., 6=Sat)
        function getDayName(dayIndex) {
            // Use modulo operator to handle wrap-around from 6 (Sat) to 0 (Sun) if needed, 
            // though for collection schedules, indices 1-6 are usually sufficient.
            return ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][dayIndex % 7];
        }

        /**
         * Calculates the collection schedule for the week based on a holiday delay (fixed one-day shift).
         * @param {object} holiday - The holiday object causing the delay.
         * @returns {string} HTML string of the revised schedule.
         */
        function calculateSchedule(holiday) {
            // Collection days: Monday=1, ..., Friday=5
            const collectionDays = [1, 2, 3, 4, 5];
            const holidayDay = holiday.affectsDay; // Day index (1-5) of the holiday

            let html = '';
            
            // Generate the list of original collection days and their revised schedule
            html += collectionDays.map(originalDay => {
                let newDayIndex = originalDay;
                let isDelayed = false;

                if (
                    (holiday.delayType === 'full_week' && holidayDay === 1) || // E.g., Memorial Day (Mon) shifts whole week
                    (holiday.delayType === 'remainder' && originalDay >= holidayDay) // E.g., Thanksgiving (Thu) shifts Thu/Fri
                ) {
                    newDayIndex = originalDay + 1; // Shift by exactly one day
                    isDelayed = true;
                }
                
                const newDayName = getDayName(newDayIndex);
                const originalDayName = getDayName(originalDay);
                
                let icon = isDelayed 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent-yes mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 17l-4 4-4-4"/><path d="M12 12V3"/></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent-no mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17L4 12"/></svg>`;

                let statusText = isDelayed 
                    ? `<span class="font-semibold text-accent-yes">${newDayName}</span>`
                    : `<span class="font-semibold text-accent-no">${newDayName} (Regular)</span>`;

                return `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0 text-gray-700">
                        <div class="flex items-center text-lg">
                            ${icon} 
                            <span class="font-medium">Collection originally on ${originalDayName}:</span>
                        </div>
                        ${statusText}
                    </div>
                `;
            }).join('');
            
            return html;
        }

        function init() {
            const datePicker = document.getElementById('debug-date-picker');
            const debugDate = datePicker.value;
            
            // Get current week using the debug date if present
            const { start, end, now } = getCurrentWeek(debugDate); 

            const statusContainer = document.getElementById('status-container');
            const holidayList = document.getElementById('holiday-list');
            const scheduleCard = document.getElementById('delay-schedule-card');
            const scheduleDetails = document.getElementById('schedule-details');
            const rangeAlert = document.getElementById('range-alert');
            
            // 0. Check if the current date is within the known calendar range
            // Need to compare date objects only (CALENDAR_START/END are already midnight)
            const isDateInRange = now >= CALENDAR_START && now <= CALENDAR_END;
            
            if (!isDateInRange) {
                // Show Alert
                rangeAlert.classList.remove('hidden');
                rangeAlert.innerHTML = `<div class="p-3 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg shadow-sm">
                    ‚ö†Ô∏è Warning: The selected date (${formatDate(now)}) is outside the published Town Calendar range (Jul 1, 2025 - Jun 30, 2026).
                </div>`;
                
                // Update main status to reflect the uncertainty
                statusContainer.innerHTML = `
                    <div class="status-text text-gray-400">?</div>
                    <div class="text-2xl font-medium text-gray-500 mt-2">Date Outside Calendar Range</div>
                `;

                // Clear and hide other elements
                scheduleCard.classList.add('hidden');
                holidayList.innerHTML = '<li class="py-3 text-center text-gray-400">Cannot determine status outside the calendar range.</li>';
                return; // Stop execution if out of range
            } else {
                rangeAlert.classList.add('hidden'); // Hide if we are in range
            }


            // 1. Check for delay this week and identify any holiday
            let isDelayed = false;
            let delayReason = "";
            let holidayThisWeek = null;

            // Find ALL holidays this week (delaying or not)
            const allHolidaysThisWeek = delayHolidays.filter(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m - 1, d);
                hDate.setHours(0, 0, 0, 0); 
                return hDate >= start && hDate <= end;
            });
            
            // Prioritize a holiday that causes a delay
            const delayingHoliday = allHolidaysThisWeek.find(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m-1, d);
                // Check if it's a weekday holiday that is *not* type 'none'
                return h.delayType !== 'none' && hDate.getDay() >= 1 && hDate.getDay() <= 5;
            });

            if (delayingHoliday) {
                isDelayed = true;
                holidayThisWeek = delayingHoliday;
                const [y, m, d] = delayingHoliday.date.split('-').map(Number);
                const hDate = new Date(y, m-1, d);
                delayReason = `Due to ${delayingHoliday.name} on ${getDayName(hDate.getDay())}`;
            }

            // 2. Update Main Display
            let secondaryNote = "";
            if (!isDelayed) {
                 // Check if there's a holiday this week that *doesn't* cause a delay
                 const nonDelayingHolidays = allHolidaysThisWeek.filter(h => h.delayType === 'none').map(h => h.name);
                 if (nonDelayingHolidays.length > 0) {
                    secondaryNote = `<span class="text-gray-400 font-medium"> (despite ${nonDelayingHolidays.join(' and ')})</span>`;
                 }
            }
            
            if (isDelayed) {
                statusContainer.innerHTML = `
                    <div class="status-text status-yes">YES</div>
                    <div class="text-2xl font-medium text-gray-500 mt-2">${delayReason}</div>
                `;
                // Show the schedule card
                scheduleCard.classList.remove('hidden');
                scheduleDetails.innerHTML = calculateSchedule(holidayThisWeek);

            } else {
                statusContainer.innerHTML = `
                    <div class="status-text status-no">NO</div>
                    <div class="text-2xl font-medium text-gray-500 mt-2">Regular Schedule ${secondaryNote}</div>
                `;
                // Hide the schedule card
                scheduleCard.classList.add('hidden');
            }

            // 3. Populate Upcoming Holidays List
            holidayList.innerHTML = ''; // Clear existing list
            
            // Filter for future holidays (including the 'now' date) AND within the calendar end date
            const upcoming = delayHolidays.filter(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m - 1, d);
                hDate.setHours(0, 0, 0, 0);
                // Check if the holiday is now or in the future AND within the calendar range
                return hDate >= now && hDate <= CALENDAR_END; 
            }).sort((a, b) => new Date(a.date) - new Date(b.date))
            .slice(0, 5); // Show next 5

            upcoming.forEach(h => {
                const [y, m, d] = h.date.split('-').map(Number);
                const hDate = new Date(y, m - 1, d);
                const dayName = getDayName(hDate.getDay());
                
                let delayNote = '';
                if (h.delayType === 'full_week' || h.delayType === 'remainder') {
                    delayNote = `(<span class="text-accent-yes font-bold">1-Day Delay</span>)`;
                } else {
                    delayNote = `(<span class="text-accent-no font-bold">No Delay Expected</span>)`;
                }

                const li = document.createElement('li');
                li.className = 'py-3 flex justify-between text-lg';
                li.innerHTML = `
                    <span>${h.name} ${delayNote}</span>
                    <span class="font-bold text-gray-600">${formatDate(hDate)} (${dayName})</span>
                `;
                holidayList.appendChild(li);
            });
            
            if (upcoming.length === 0) {
                 holidayList.innerHTML = '<li class="py-3 text-center text-gray-400">No major holidays with confirmed delays found in the current calendar.</li>';
            }
        }

        // --- Event Listeners for Debug Feature ---
        const debugContent = document.getElementById('debug-content');
        const toggleButton = document.getElementById('debug-toggle');
        // Removed toggleIcon reference as it is no longer used.

        toggleButton.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent the <a> tag from attempting to navigate
            debugContent.classList.toggle('hidden');
            
            // Update the link text to reflect the state
            if (debugContent.classList.contains('hidden')) {
                toggleButton.textContent = 'Click to change date';
            } else {
                toggleButton.textContent = 'Hide date picker';
            }
        });

        document.getElementById('debug-date-picker').addEventListener('change', init);
        
        document.getElementById('reset-date-btn').addEventListener('click', () => {
             // Clear the date input and re-run init() to use the actual current date
             document.getElementById('debug-date-picker').value = '';
             init();
        });

        // Initial run
        init();
    </script>
</body>
</html>
